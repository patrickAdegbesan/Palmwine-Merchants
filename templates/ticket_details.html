{% extends 'base.html' %}
{% load static %}

{% block title %}{{ ticket.code }} - Ticket Details{% endblock %}

{% block extra_css %}
<style>
.ticket-container {
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
}

.ticket-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 30px;
    margin-bottom: 20px;
}

.ticket-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 2px solid #eee;
}

.ticket-header .event-icon {
    width: 60px;
    height: 60px;
    background: #2c5530;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 20px;
}

.ticket-header .event-icon i {
    color: white;
    font-size: 24px;
}

.ticket-header .event-info h1 {
    margin: 0;
    font-size: 24px;
    color: #2c5530;
}

.ticket-header .event-info p {
    margin: 5px 0 0;
    color: #666;
}

.ticket-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.detail-item {
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
}

.detail-item .label {
    color: #666;
    font-size: 14px;
    margin-bottom: 5px;
}

.detail-item .value {
    color: #333;
    font-size: 16px;
    font-weight: 600;
}

.qr-section {
    text-align: center;
    margin: 40px 0;
}

.qr-code {
    padding: 20px;
    background: white;
    display: inline-block;
    border-radius: 10px;
    margin-bottom: 15px;
}

.verification-status {
    display: inline-flex;
    align-items: center;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    margin-top: 10px;
}

.verification-status.verified {
    background: #e8f5e9;
    color: #2e7d32;
}

.verification-status.unverified {
    background: #fff3e0;
    color: #ef6c00;
}

.verification-status i {
    margin-right: 8px;
}

.ticket-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 30px;
}

.action-button {
    display: inline-flex;
    align-items: center;
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
}

.action-button.primary {
    background: #2c5530;
    color: white;
}

.action-button.secondary {
    background: #f5f5f5;
    color: #333;
}

.action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.action-button i {
    margin-right: 8px;
}
</style>
{% endblock %}

{% block content %}
<div class="ticket-container">
    <div class="ticket-card">
        <div class="ticket-header">
            <div class="event-icon">
                <i class="fas fa-ticket-alt"></i>
            </div>
            <div class="event-info">
                <h1>{{ ticket.event_name }}</h1>
                <p>{{ ticket.event_date|date:"l, F j, Y â€¢ g:i A" }}</p>
            </div>
        </div>

        <div class="ticket-details">
            <div class="detail-item">
                <div class="label">Ticket Code</div>
                <div class="value">{{ ticket.code }}</div>
            </div>
            <div class="detail-item">
                <div class="label">Customer Name</div>
                <div class="value">{{ ticket.customer_name }}</div>
            </div>
            <div class="detail-item">
                <div class="label">Quantity</div>
                <div class="value">{{ ticket.quantity }} ticket{{ ticket.quantity|pluralize }}</div>
            </div>
            <div class="detail-item">
                <div class="label">Amount Paid</div>
                <div class="value">â‚¦{{ ticket.amount|floatformat:2 }}</div>
            </div>
            <div class="detail-item">
                <div class="label">Purchase Date</div>
                <div class="value">{{ ticket.purchase_date|date:"M j, Y" }}</div>
            </div>
            <div class="detail-item">
                <div class="label">Location</div>
                <div class="value">{{ ticket.event_location }}</div>
            </div>
        </div>

        {% if ticket.verified %}
        <div class="verification-status verified">
            <i class="fas fa-check-circle"></i> Verified on {{ ticket.verified_at|date:"M j, Y â€¢ g:i A" }}
        </div>
        {% else %}
        <div class="verification-status unverified">
            <i class="fas fa-clock"></i> Not Yet Verified
        </div>
        {% endif %}

        <div class="qr-section">
            <div class="qr-code">
                <div id="qr-placeholder"></div>
            </div>
            <p>Present this QR code at the event entrance</p>
        </div>

        <div class="ticket-actions">
            <a href="/api/download-ticket/{{ ticket.code }}/" class="action-button primary">
                <i class="fas fa-download"></i> Download PDF
            </a>
            <button onclick="shareTicket()" class="action-button secondary">
                <i class="fas fa-share-alt"></i> Share Ticket
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Generate QR code
    const ticketData = {
        code: '{{ ticket.code }}',
        event: '{{ ticket.event_name }}',
        date: '{{ ticket.event_date }}',
        customer: '{{ ticket.customer_name }}',
        quantity: {{ ticket.quantity }}
    };

    QRCode.toCanvas(document.getElementById('qr-placeholder'), JSON.stringify(ticketData), {
        width: 200,
        height: 200,
        margin: 1,
        color: {
            dark: '#2c5530',
            light: '#ffffff'
        }
    });
});

function shareTicket() {
    const message = encodeURIComponent(
        `ðŸŽ‰ My Palmwine Merchants Ticket!\n\n` +
        `Event: {{ ticket.event_name }}\n` +
        `Date: {{ ticket.event_date|date:"l, F j, Y" }}\n` +
        `Ticket Code: {{ ticket.code }}\n\n` +
        `Verify at: ${window.location.origin}/verify/{{ ticket.code }}`
    );
    window.open(`https://wa.me/?text=${message}`, '_blank');
}
</script>
{% endblock %}
